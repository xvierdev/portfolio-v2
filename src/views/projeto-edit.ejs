<section class="info-section">
    <h3>Editando Projeto: <%= projeto.titulo %></h3>
    
    <div id="feedback-message" style="padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; display: none;">
        </div>
    
    <form id="form-editar-projeto" class="recado-form"> 
        <input type="hidden" id="projeto-id" value="<%= projeto.id %>">
        
        <div class="form-group">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" name="titulo" value="<%= projeto.titulo %>" required>
        </div>
        <div class="form-group">
            <label for="tecnologias">Tecnologias:</label>
            <input type="text" id="tecnologias" name="tecnologias" value="<%= projeto.tecnologias %>" required>
        </div>
        <div class="form-group">
            <label for="descricao">Descrição:</label>
            <textarea id="descricao" name="descricao" rows="4" required><%= projeto.descricao %></textarea>
        </div>
        <div class="form-group">
            <label for="linkGithub">Link GitHub (Opcional):</label>
            <input type="url" id="linkGithub" name="linkGithub" value="<%= projeto.linkGithub %>">
        </div>
        <div class="form-group">
            <label for="linkDemo">Link Demo (Opcional):</label>
            <input type="url" id="linkDemo" name="linkDemo" value="<%= projeto.linkDemo %>">
        </div>
        
        <button type="submit" class="btn-save">Salvar Alterações</button>
        <a href="/projetos" class="btn-cancel">Cancelar e Voltar</a>
    </form>
</section>

<script>
    const formEditarProjeto = document.getElementById('form-editar-projeto');
    const feedbackMessage = document.getElementById('feedback-message');
    const API_URL = '/api/projetos';

    // --- FUNÇÃO DE FEEDBACK (Reutilizada) ---
    function exibirFeedback(mensagem, tipo = 'success') {
        // ... (Implementação da função de feedback) ...
        feedbackMessage.textContent = mensagem;
        feedbackMessage.style.display = 'block';
        feedbackMessage.style.backgroundColor = tipo === 'success' ? '#d4edda' : '#f8d7da';
        feedbackMessage.style.borderColor = tipo === 'success' ? '#c3e6cb' : '#f5c6cb';
        feedbackMessage.style.color = tipo === 'success' ? '#155724' : '#721c24';
        setTimeout(() => { feedbackMessage.style.display = 'none'; }, 5000);
    }

    // --- EVENT LISTENER PARA ATUALIZAR PROJETO (PUT) ---
    formEditarProjeto.addEventListener('submit', async (e) => {
        e.preventDefault(); 
        
        const projetoId = document.getElementById('projeto-id').value;
        
        // Coleta todos os dados do formulário
        const dados = {
            titulo: document.getElementById('titulo').value,
            tecnologias: document.getElementById('tecnologias').value,
            descricao: document.getElementById('descricao').value,
            linkGithub: document.getElementById('linkGithub').value,
            linkDemo: document.getElementById('linkDemo').value
        };
        
        exibirFeedback('Salvando alterações...', 'info');

        try {
            const response = await fetch(`${API_URL}/${projetoId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            });

            const data = await response.json();

            if (response.status === 200) { // 200 OK
                exibirFeedback('Projeto atualizado com sucesso!', 'success');
                // Opcional: Atualiza o título da página
                document.querySelector('h3').textContent = `Editando Projeto: ${dados.titulo}`;
                
            } else if (response.status === 400 || response.status === 404) {
                exibirFeedback(`Erro: ${data.mensagem}`, 'error');
            } else {
                exibirFeedback(`Erro desconhecido: Status ${response.status}`, 'error');
            }
        } catch (error) {
            exibirFeedback('Erro de rede ao salvar o projeto.', 'error');
        }
    });
</script>